# V1 vs V2 方案比較

## 📊 兩種方案對比

| 項目 | V1 座標版 (舊) | V2 軸線版 (新) ⭐推薦 |
|------|---------------|-------------------|
| **核心概念** | 絕對座標轉換 | 軸線相對位置匹配 |
| **需要設定** | 基準點 + 縮放比例 | 僅需軸線對應 |
| **使用者操作** | 手動點選基準點 | 全自動偵測 |
| **準確度** | 依賴人工點選 | 依賴軸線標註 |
| **直觀性** | ★★☆☆☆ | ★★★★★ |
| **錯誤率** | 中等（易點錯） | 低（自動匹配） |

---

## 🔄 V1 座標版運作原理

### **流程**

```
ETABS 梁 B65:
  中點座標 (14.25, 2.6) 公尺
     ↓
使用者點選基準點 (5000, 3000)
     ↓
設定縮放比例 1000 (1m = 1000mm)
     ↓
計算 AutoCAD 座標:
  X = 5000 + 14.25 × 1000 = 19250
  Y = 3000 + 2.6 × 1000 = 5600
     ↓
在 (19250, 5600) 標註 "GAa-3"
```

### **JSON 格式**

```json
{
  "etabsId": "B65",
  "newLabel": "GAa-3",
  "midPoint": {
    "x": 14.25,  // 公尺
    "y": 2.6     // 公尺
  }
}
```

### **優點**
- ✅ 簡單直接
- ✅ 適用於任何圖面

### **缺點**
- ❌ 需要手動點選基準點（每個樓層都要點）
- ❌ 需要設定縮放比例（容易設錯）
- ❌ 單位轉換容易出錯
- ❌ 不直觀（使用者需要理解座標系統）

---

## ⭐ V2 軸線版運作原理（推薦）

### **流程**

```
ETABS 梁 B65:
  沿著軸線 A
  在軸線 2 和 3 之間
  水平梁
     ↓
AutoCAD 外掛偵測軸線:
  找到軸線 A 的位置
  找到軸線 2 的位置
  找到軸線 3 的位置
     ↓
在 AutoCAD 中搜尋:
  在軸線 A 上
  且在軸線 2-3 之間的梁
     ↓
找到對應的梁線
     ↓
在梁中點上方標註 "GAa-3"
```

### **JSON 格式**

```json
{
  "etabsId": "B65",
  "newLabel": "GAa-3",
  "gridInfo": {
    "alongGrid": "A",        // 沿著 A 軸線
    "between": ["2", "3"],   // 在 2-3 之間
    "direction": "horizontal", // 水平梁
    "length": 5.1            // 長度（用於驗證）
  }
}
```

### **優點**
- ✅ **完全自動化** - 無需手動點選
- ✅ **單位無關** - 不需要轉換
- ✅ **非常直觀** - 使用者容易理解
- ✅ **準確度高** - 基於軸線系統匹配
- ✅ **易於驗證** - 可以肉眼確認是否正確

### **缺點**
- ❌ 需要 AutoCAD 圖中有清楚的軸線標註
- ❌ 軸線標註必須是文字物件（不能是圖塊內的文字）

---

## 🎯 實際範例比較

### **範例：標註 B65 梁**

#### **V1 方式（座標版）**

```
使用者操作:
1. 點選「匯出 JSON V1」
2. 在 AutoCAD 執行 LABELBEAMS
3. 選擇 JSON 檔案
4. 選擇樓層 (2F)
5. 點選基準點 ← 需要準確點選軸線 0-A 交點
6. 輸入縮放比例 1000 ← 需要知道單位
7. 輸入文字高度 250
8. 完成

問題:
- 步驟 5: 如果點錯位置，所有標註都會偏移
- 步驟 6: 如果輸入錯誤（例如 100），所有標註都會縮放錯誤
```

#### **V2 方式（軸線版）**

```
使用者操作:
1. 點選「匯出 JSON V2」
2. 在 AutoCAD 執行 LABELBEAMSV2
3. 選擇 JSON 檔案
4. 選擇樓層 (2F)
5. 輸入文字高度 250
6. 完成 ← 自動偵測軸線並匹配梁

優點:
- 無需點選基準點
- 無需設定縮放比例
- 自動找到對應的梁
```

---

## 🔍 V2 匹配演算法

### **步驟 1: 偵測軸線**

外掛會搜尋 AutoCAD 圖中所有文字物件，找到軸線標註：

```csharp
// 找到的軸線
X 軸線: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
Y 軸線: A, B, C, C', C'', C'''

// 記錄每條軸線的位置
軸線 2 位於 X=15000
軸線 3 位於 X=20000
軸線 A 位於 Y=5000
```

### **步驟 2: 計算理論梁位置**

根據 JSON 資訊計算梁應該在哪裡：

```csharp
// 梁 B65: 沿著 A，在 2-3 之間，水平
起點 = (軸線2的X, 軸線A的Y) = (15000, 5000)
終點 = (軸線3的X, 軸線A的Y) = (20000, 5000)
```

### **步驟 3: 在 AutoCAD 中搜尋匹配的梁**

```csharp
foreach (梁線 in AutoCAD圖面) {
  if (梁線的起點 ≈ 理論起點 && 梁線的終點 ≈ 理論終點) {
    找到了！
    在這根梁的中點上方標註 "GAa-3"
  }
}
```

### **容許誤差**

由於 AutoCAD 繪圖可能有些微誤差，所以設定容許範圍：

```
容許誤差 = 500mm

如果梁線的端點距離理論位置 < 500mm
→ 視為匹配成功
```

---

## 📋 建議使用情境

### **使用 V1 座標版**

- ❌ AutoCAD 圖中沒有軸線標註
- ❌ 軸線標註不是標準文字
- ❌ 軸線命名與 ETABS 不同

### **使用 V2 軸線版（強烈推薦）**

- ✅ AutoCAD 圖有清楚的軸線標註
- ✅ 軸線編號與 ETABS 一致
- ✅ 想要全自動化標註
- ✅ 有多個樓層需要標註

---

## 🚀 遷移指南

### **從 V1 升級到 V2**

如果你之前用過 V1，升級到 V2 很簡單：

1. **重新匯出 JSON**
   - 開啟 HTML 工具
   - 點選「匯出 JSON V2 (軸線版)」

2. **在 AutoCAD 中使用新命令**
   - `LABELBEAMSV2` (取代原本的 `LABELBEAMS`)

3. **檢查軸線標註**
   - 確保 AutoCAD 圖中有軸線文字
   - 軸線編號與 ETABS 一致

---

## ❓ 常見問題

### Q: V2 一定比 V1 好嗎？

A: 大部分情況是的！除非你的 AutoCAD 圖沒有軸線標註。

### Q: 可以同時保留兩個版本嗎？

A: 可以！HTML 工具提供兩種匯出選項，AutoCAD 外掛也支援兩種命令。

### Q: V2 如果找不到軸線怎麼辦？

A: 外掛會提示哪些軸線沒找到，你可以：
1. 檢查軸線文字是否存在
2. 或改用 V1 方式

### Q: V2 的容許誤差可以調整嗎？

A: 可以！在 JSON 中有 `tolerance` 欄位，預設 0.1 公尺（100mm）。

---

## 📊 總結

| 情境 | 推薦版本 |
|------|---------|
| 標準結構圖（有軸線） | V2 ⭐⭐⭐⭐⭐ |
| 無軸線標註的圖 | V1 |
| 大量樓層需要標註 | V2 ⭐⭐⭐⭐⭐ |
| 快速測試 | V1 |
| 追求準確度 | V2 ⭐⭐⭐⭐⭐ |

**結論：V2 軸線版在 95% 的情況下都更好！**

---

**最後更新**: 2025-10-05
**版本**: 2.0
